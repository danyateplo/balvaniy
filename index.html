<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <title>Gemini AI</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <style>
    :root {
  --bg-color: #000000;
  --header-bg: rgba(18, 18, 18, 0.8);
  --user-bubble: linear-gradient(135deg, #007aff, #0056b3);
  --bot-bubble: #1c1c1e;
  --text-main: #ffffff;
  --accent: #4da3ff;
  --input-bg: #2c2c2e;
}

body {
  margin: 0;
  background-color: var(--bg-color);
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
  color: var(--text-main);
}

/* Тонкая полоска градиента сверху для красоты */
.app-container::before {
  content: "";
  position: absolute;
  top: 0; width: 100%; height: 3px;
  background: linear-gradient(90deg, #4da3ff, #b285ff, #4da3ff);
  z-index: 100;
}

.header {
  padding: 18px;
  background: var(--header-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  border-bottom: 0.5px solid rgba(255, 255, 255, 0.1);
  text-align: center;
}

.header-title {
  font-size: 18px;
  font-weight: 700;
  letter-spacing: -0.5px;
}

.chat-area {
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 12px;
  /* Плавный скролл */
  scroll-behavior: smooth;
}

.bubble {
  max-width: 85%;
  padding: 12px 16px;
  border-radius: 20px;
  font-size: 16px;
  line-height: 1.4;
  box-shadow: 0 2px 10px rgba(0,0,0,0.3);
}

.user {
  align-self: flex-end;
  background: var(--user-bubble);
  border-bottom-right-radius: 5px;
}

.bot {
  align-self: flex-start;
  background: var(--bot-bubble);
  border-bottom-left-radius: 5px;
  border: 1px solid rgba(255, 255, 255, 0.05);
}

/* Кнопка копирования теперь выглядит аккуратнее */
.copy-btn {
  margin-top: 10px;
  font-size: 11px;
  color: var(--accent);
  opacity: 0.6;
  text-align: right;
  cursor: pointer;
}

.input-container {
  padding: 15px 15px 35px 15px;
  background: var(--header-bg);
  backdrop-filter: blur(20px);
}

.input-wrapper {
  background: var(--input-bg);
  border-radius: 25px;
  padding: 5px 5px 5px 15px;
  border: 1px solid rgba(255, 255, 255, 0.1);
  display: flex;
  align-items: center;
}

input {
  flex: 1;
  background: transparent;
  border: none;
  color: #fff;
  font-size: 16px;
  padding: 10px 0;
  outline: none;
}

#send-btn {
  background: #fff; /* Белая кнопка на черном фоне — очень стильно */
  transition: all 0.2s;
}

#send-btn svg {
  fill: #000;
}

#send-btn:disabled {
  background: #555;
  opacity: 0.5;
}

    button:active { transform: scale(0.9); }
    button svg { fill: #000; width: 18px; height: 18px; }

    .loading { opacity: 0.5; font-size: 13px; font-style: italic; }
  </style>
</head>
<body>
  <div class="app-container">
    <div class="header">
      <div class="header-title">Gemini AI Assistant</div>
    </div>

  <div id="chat" class="chat-area">
    <div class="bubble bot">
    Привет! Я готов помочь. Какой у тебя вопрос?<br><br>
    <small style="opacity: 0.7;">
      ⚠️ История чата будет очищена после закрытия вкладки.<br>
      ⏳ В бесплатной версии есть лимиты: если они закончатся, чат временно заблокируется для отдыха.
    </small>
</div>

    <div class="input-container">
      <div class="input-wrapper">
        <input id="input" type="text" placeholder="Сообщение..." autocomplete="off">
        <button onclick="send()" id="send-btn">
          <svg viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg>
        </button>
      </div>
    </div>
  </div>

<script>
  const tg = window.Telegram.WebApp;
  tg.expand();
  tg.headerColor = "#0f0f0f";
  tg.backgroundColor = "#050505";

  const chat = document.getElementById('chat');
  const input = document.getElementById('input');

  function addMessage(text, role) {
    const div = document.createElement('div');
    div.className = 'bubble ' + role;
    
    if (role === 'bot') {
      div.innerHTML = marked.parse(text);
      const copy = document.createElement('div');
      copy.className = 'copy-btn';
      copy.innerText = 'Копировать';
      copy.onclick = () => {
        navigator.clipboard.writeText(text);
        copy.innerText = 'Готово!';
        setTimeout(() => copy.innerText = 'Копировать', 2000);
        tg.HapticFeedback.notificationOccurred('success');
      };
      div.appendChild(copy);
    } else {
      div.textContent = text;
    }

    chat.appendChild(div);
    chat.scrollTop = chat.scrollHeight;
    return div;
  }

  async function send() {
    const text = input.value.trim();
    if (!text || input.disabled) return;
    
    tg.HapticFeedback.impactOccurred('light');
    input.value = '';
    addMessage(text, 'user');

    const load = addMessage('Генерирую ответ...', 'bot');
    load.classList.add('loading');
    const sendBtn = document.getElementById('send-btn');

    try {
      const res = await fetch('/chat', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ text })
      });
      const data = await res.json();
      load.remove();
      addMessage(data.answer || 'Ошибка API', 'bot');

      // Если бэкенд сообщил о лимите
      if (data.is_limit) {
        setLimitMode(20); // Блокировка на 20 секунд
      }

    } catch (e) {
      load.remove();
      addMessage('Ошибка соединения', 'bot');
    }
  }

  function setLimitMode(seconds) {
    const sendBtn = document.getElementById('send-btn');
    let timeLeft = seconds;

    input.disabled = true;
    sendBtn.disabled = true;
    input.placeholder = `Подождите ${timeLeft}с...`;
    
    const timer = setInterval(() => {
      timeLeft--;
      input.placeholder = `Подождите ${timeLeft}с...`;
      
      if (timeLeft <= 0) {
        clearInterval(timer);
        input.disabled = false;
        sendBtn.disabled = false;
        input.placeholder = "Сообщение...";
        tg.HapticFeedback.notificationOccurred('success');
      }
    }, 1000);
  }

  input.addEventListener('keypress', (e) => { if (e.key === 'Enter') send(); });
</script>
</body>

</html>




